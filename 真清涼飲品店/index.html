<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
    <style>
      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: url('https://images.unsplash.com/photo-1560508180-03f285f67ded?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=80') no-repeat center
          center;
        background-size: cover;
      }
      .container {
        background-color: rgba(0, 0, 0, 0.8);
        border-radius: 3px;
      }
      .row {
        max-height: 600px;
      }
      .col-md-4 {
        max-height: 580px;
        overflow-y: auto;
      }
      [data-alpha-pos='delete-drink'] {
        display: inline-block;
        text-align: center;
        color: #999;
        cursor: pointer;
        width: 20px;
        height: 20px;
        font-size: 20px;
        line-height: 1;
      }
      [data-alpha-pos='delete-drink']:hover {
        color: #333;
      }
      .menu .card-body {
        cursor: pointer;
      }
      .menu .card-body:hover {
        box-shadow: 0px 0px 10px 1px rgba(255, 255, 255, 0.8);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2 class="text-center pt-4 text-light">Alpha Pos System</h2>
      <div class="row">
        <!--    left side card list    -->
        <div class="col-md-4 p-4" data-order-lists>
          <!--   checkout button     -->
          <div class="text-right">
            <button class="btn btn-light" style="min-width: 120px" data-alpha-pos="checkout">Checkout</button>
          </div>
        </div>
        <!--    right side card list    -->
        <div class="col-md-8 p-4">
          <section class="menu mb-4">
            <div class="card-deck mb-3">
              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Black Tea</h5>
                  <input type="radio" name="drink" value="Black Tea" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Oolong Tea</h5>
                  <input type="radio" name="drink" value="Oolong Tea" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Baozong Tea</h5>
                  <input type="radio" name="drink" value="Baozong Tea" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Green Tea</h5>
                  <input type="radio" name="drink" value="Green Tea" />
                </label>
              </div>
            </div>

            <div class="card-deck">
              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Bubble Milk Tea</h5>
                  <input type="radio" name="drink" value="Bubble Milk Tea" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Black Tea Latte</h5>
                  <input type="radio" name="drink" value="Black Tea Latte" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Lemon Green</h5>
                  <input type="radio" name="drink" value="Lemon Green Tea" />
                </label>
              </div>

              <div class="card text-center">
                <label class="card-body px-2">
                  <h5 class="card-title">Matcha Latte</h5>
                  <input type="radio" name="drink" value="Matcha Latte" />
                </label>
              </div>
            </div>
          </section>
          <section class="ice mb-4">
            <label class="d-block text-light">Ice</label>
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
              <label class="btn btn-outline-primary"> <input type="radio" name="ice" value="No Ice" />No </label>
              <label class="btn btn-outline-primary"> <input type="radio" name="ice" value="Less Ice" />Less </label>
              <label class="btn btn-outline-primary active"> <input type="radio" name="ice" value="Regular Ice" checked="checked" />Regular </label>
            </div>
          </section>
          <section class="sugar mb-5">
            <label class="d-block text-light">Sugar</label>
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
              <label class="btn btn-outline-info"> <input type="radio" name="sugar" value="No Sugar" />No </label>
              <label class="btn btn-outline-info"> <input type="radio" name="sugar" value="A Little Sugar" />A Little </label>
              <label class="btn btn-outline-info"> <input type="radio" name="sugar" value="Half Sugar" />Half </label>
              <label class="btn btn-outline-info"> <input type="radio" name="sugar" value="Less Sugar" />Less </label>
              <label class="btn btn-outline-info active"> <input type="radio" name="sugar" value="Regular Sugar" checked="checked" />Regular </label>
            </div>
          </section>
          <div class="text-right">
            <div class="btn btn-light" style="min-width: 120px" data-alpha-pos="add-drink">Add</div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // new the alphaPos Instance
      const alphaPos = new AlphaPos()

      const addDrinkButton = document.querySelector('[data-alpha-pos="add-drink"]')
      addDrinkButton.addEventListener('click', function () {
        // 1. 取得店員選擇的飲料品項、甜度和冰塊
        const drinkName = alphaPos.getCheckedValue('drink')
        const ice = alphaPos.getCheckedValue('ice')
        const sugar = alphaPos.getCheckedValue('sugar')
        // 2. 如果沒有選擇飲料品項，跳出提示
        if (!drinkName) {
          alert('您還未選擇任何品項!')
          return
        }
        // 3. 建立飲料實例，並取得飲料價格
        const drink = new Drink(drinkName, sugar, ice)
        console.log(drink)
        console.log(drink.price())
        // 4. 將飲料實例產生成左側訂單區的畫面
        alphaPos.addDrink(drink)
      })

      const orderLists = document.querySelector('[data-order-lists]')
      orderLists.addEventListener('click', function (event) {
        let isDeleteButton = event.target.matches('[data-alpha-pos="delete-drink"]')
        if (!isDeleteButton) {
          return
        }

        // delete the card element
        alphaPos.deleteDrink(event.target.parentElement.parentElement.parentElement)
      })

      const checkoutButton = document.querySelector('[data-alpha-pos="checkout"]')
      checkoutButton.addEventListener('click', function () {
        // 1. 計算訂單總金額
        alert(`Total amount of drinks：$${alphaPos.checkout()}`)

        // 2. 清空訂單
        alphaPos.clearOrder(orderLists)
      })

      // Constructor function for Alpha Pos System
      function AlphaPos() {}
      AlphaPos.prototype.getCheckedValue = function (inputName) {
        let selectedOption = ''
        document.querySelectorAll(`[name=${inputName}]`).forEach(function (item) {
          if (item.checked) {
            selectedOption = item.value
          }
        })
        return selectedOption
      }

      AlphaPos.prototype.addDrink = function (drink) {
        let orderListsCard = `
    <div class="card mb-3">
    <div class="card-body pt-3 pr-3">
      <div class="text-right">
        <span data-alpha-pos="delete-drink">×</span>
      </div>
      <h6 class="card-title mb-1">${drink.name}</h6>
      <div class="card-text">${drink.ice}</div>
      <div class="card-text">${drink.sugar}</div>
    </div>
    <div class="card-footer text-right py-2">
      <div class="card-text text-muted">$ <span data-drink-price>${drink.price()}</span></div>
    </div>
  </div>
  `

        orderLists.insertAdjacentHTML('afterbegin', orderListsCard)
      }

      AlphaPos.prototype.deleteDrink = function (target) {
        target.remove()
      }

      AlphaPos.prototype.checkout = function () {
        let totalAmount = 0
        document.querySelectorAll('[data-drink-price]').forEach(function (drink) {
          totalAmount += Number(drink.textContent)
        })
        return totalAmount
      }

      AlphaPos.prototype.clearOrder = function (target) {
        target.querySelectorAll('.card').forEach(function (card) {
          card.remove()
        })
      }

      // constructor function for drinks
      function Drink(name, sugar, ice) {
        this.name = name
        this.sugar = sugar
        this.ice = ice
      }
      Drink.prototype.price = function () {
        switch (this.name) {
          case 'Black Tea':
          case 'Oolong Tea':
          case 'Baozong Tea':
          case 'Green Tea':
            return 30
          case 'Bubble Milk Tea':
          case 'Lemon Green Tea':
            return 50
          case 'Black Tea Latte':
          case 'Matcha Latte':
            return 55
          default:
            alert('無此產品，請確認!')
        }
      }
    </script>
  </body>
</html>
